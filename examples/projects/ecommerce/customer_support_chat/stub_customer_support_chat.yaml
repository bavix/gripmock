# yaml-language-server: $schema=https://bavix.github.io/gripmock/schema/stub.json

## Bidirectional Streaming - Customer support chat (explicit inputs and outputs)
- service: ecommerce.EcommerceService
  method: CustomerSupportChat
  inputs:
    - &user789
      equals:
        user_id: "USER_789"
    - *user789
    - *user789
    - *user789
  output:
    stream:
      - &support_resp
        messageId: "MSG_{{.MessageIndex}}_SUPPORT"
        userId: "SUPPORT_001"
        content: "Hello! I'm support agent for message {{.MessageIndex}}. How can I help you with: {{.Request.content}}"
        timestamp: "{{.Request.timestamp}}"
        senderType: "support"
      - *support_resp
      - *support_resp
      - *support_resp

# Additional stub to verify that bidi doesn't substitute wrong responses
- service: ecommerce.EcommerceService
  method: CustomerSupportChat
  inputs:
    - &user999
      equals:
        user_id: "USER_999"
    - *user999
    - *user999
    - *user999
  output:
    stream:
      - &support_special
        messageId: "SPECIAL_{{.MessageIndex}}"
        userId: "SUPPORT_SPECIAL"
        content: "Special support for user 999, message {{.MessageIndex}}: {{.Request.content}}"
        timestamp: "{{.Request.timestamp}}"
        senderType: "support"
      - *support_special
      - *support_special
      - *support_special
